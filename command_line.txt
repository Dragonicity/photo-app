Create Application:

rails new app-name
rails generate controller welcome index
Change get 'welcome/index' to root 'welcome#index' in routes.rb

start rails server and confirm home page shows

git init
git add -A
git commit -m "Initial commit with home page"

Deploy to Production:

In gemfile move sqlite3 gem to development group and create production group:

group :production do
  gem 'pg'
  gem 'rails_12factor'
end

bundle install --without production

create github repository for app-name

git remote add origin https://github.com/Dragonicity/photo-app.git
git push -u origin master

heroku create
heroku rename required-name

git add -A
git commit -m "Make ready for production"
git push
git push heroku master

Build Authentication System:

add gems to gemfile

gem 'devise'
gem 'twitter-bootstrap-rails'
gem 'devise-bootstrap-views'

bundle install

rails generate devise:install
rails generate devise User

update migration file to allow for confirmable email authentication

uncomment confirmable attributes in database migration file

## Confirmable
      t.string   :confirmation_token
      t.datetime :confirmed_at
      t.datetime :confirmation_sent_at
      t.string   :unconfirmed_email # Only if using reconfirmable

add confirmable option to User model:

class User < ActiveRecord::Base
  # Include default devise modules. Others available are:
  # :confirmable, :lockable, :timeoutable and :omniauthable
  devise :database_authenticatable, :registerable, :confirmable,
         :recoverable, :rememberable, :trackable, :validatable
end

rake db:migrate

restart rails server

add line to application controller:

before_action :authenticate_user!

add line to welcome controller to skip authentication if needed

skip_before_action :authenticate_user!, only: [:index]

rails generate bootstrap:install static
rails generate bootstrap:layout application (and confirm with Y)
rails generate devise:views:locale en
rails generate devise:views:bootstrap_templates

In the application.css file under app/assets/stylesheets folder, right above the line that says *= require_tree add in the following line:

*= require devise_bootstrap_views

go to sign_up page

http://localhost:3000/users/sign_up

git add -A
git commit -m "Add devise and styling"
git push

Production email:

heroku addons:create sendgrid:starter

Click on Sendgrid add-on in Heroku, go to settings, credentials and add username and password for account. Click Mail checkbox and click create credential button.

heroku config:set SENDGRID_USERNAME=mark.nelson@dragonicity.com
heroku config:set SENDGRID_PASSWORD=password

ENter the following in the ~/.zshrc file:

export SENDGRID_USERNAME=mark.nelson@dragonicity.com
export SENDGRID_PASSWORD=password

Create new terminal session to see environment variables and do set-up

In config/environment.rb add the following code:

ActionMailer::Base.smtp_settings = {
  :address => 'smtp.sendgrid.net',
  :port => '587',
  :authentication => :plain,
  :user_name => ENV['SENDGRID_USERNAME'],
  :password => ENV['SENDGRID_PASSWORD'],
  :domain => 'heroku.com',
  :enable_starttls_auto => true
}

In config/environments/develop.rb add the following (under config.eager_load = false):

config.action_mailer.delivery_method = :test
config.action_mailer.default_url_options = { :host => 'http://localhost:3000' }

In config/environments/production.rb add the following:

config.action_mailer.delivery_method = :smtp
config.action_mailer.default_url_options = { :host => 'dragon-photo-app.herokuapp.com', :protocol => 'htpps' }

Sign-up to the application (should see message that email send to activate your account).

If you get undefined local variable or method 'confirmed_at' for Devise error then reset datbase with:

rake db:migrate:reset
rake db:reset

Select confirmation link from email details in server log and paste into browser

http://localhost:3000/users/confirmation?confirmation_token=cMp2szSz2kAmci4QdayS&amp;locale=en

You should see flash message Your account was successfully confirmed.






